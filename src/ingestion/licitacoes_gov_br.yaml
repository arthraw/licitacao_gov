version: 7.0.4

type: DeclarativeSource

check:
  type: CheckStream
  stream_names:
    - Licitacoes_Gov

streams:
  - type: DeclarativeStream
    name: Licitacoes_Gov
    retriever:
      type: SimpleRetriever
      decoder:
        type: JsonDecoder
      paginator:
        type: DefaultPaginator
        page_token_option:
          type: RequestOption
          field_name: pagina
          inject_into: request_parameter
        pagination_strategy:
          type: PageIncrement
          page_size: 2
          stop_condition: "{{ response['paginasRestantes'] == 0 }}"
          start_from_page: 1
      requester:
        type: HttpRequester
        url: https://dadosabertos.compras.gov.br/modulo-legado/1_consultarLicitacao
        http_method: GET
        request_parameters:
          data_publicacao_final: "2025-12-18"
          data_publicacao_inicial: "2025-05-01"
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path:
            - resultado
    schema_loader:
      type: InlineSchemaLoader
      schema:
        type: object
        $schema: http://json-schema.org/schema#
        properties:
          uasg:
            type:
              - number
              - "null"
          objeto:
            type:
              - string
              - "null"
          id_compra:
            type:
              - string
              - "null"
          modalidade:
            type:
              - number
              - "null"
          tipo_pregao:
            type:
              - string
              - "null"
          dt_alteracao:
            type:
              - string
              - "null"
          numero_aviso:
            type:
              - number
              - "null"
          tipo_recurso:
            type:
              - string
              - "null"
          identificador:
            type:
              - string
              - "null"
          pertence14133:
            type:
              - boolean
              - "null"
          situacao_aviso:
            type:
              - string
              - "null"
          data_publicacao:
            type:
              - string
              - "null"
          nome_modalidade:
            type:
              - string
              - "null"
          numero_processo:
            type:
              - string
              - "null"
          nome_responsavel:
            type:
              - string
              - "null"
          funcao_responsavel:
            type:
              - string
              - "null"
          informacoes_gerais:
            type:
              - string
              - "null"
          data_entrega_edital:
            type:
              - string
              - "null"
          valor_estimado_total:
            type:
              - number
              - "null"
          codigo_municipio_uasg:
            type:
              - number
              - "null"
          data_entrega_proposta:
            type:
              - string
              - "null"
          data_abertura_proposta:
            type:
              - string
              - "null"
          endereco_entrega_edital:
            type:
              - string
              - "null"
        additionalProperties: true

spec:
  type: Spec
  connection_specification:
    type: object
    properties: {}

metadata:
  testedStreams:
    stream_0:
      streamHash: ad11f9fa446b445a056b0f48d54e74059e0bc977
    Licitacoes_Gov:
      isStale: false
      hasRecords: true
      streamHash: 9eaac6e36edc2ecec5eaf591266c9eb27c6ede1a
      hasResponse: true
      primaryKeysAreUnique: true
      primaryKeysArePresent: true
      responsesAreSuccessful: true
  autoImportSchema:
    Licitacoes_Gov: true

concurrency_level:
  type: ConcurrencyLevel
  default_concurrency: 1
